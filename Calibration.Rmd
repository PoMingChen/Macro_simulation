---
title: "Marco Mid-term HW Calibration"
author: "Group2"
date: "2018/12/6"
output:
     pdf_document:
         latex_engine: xelatex
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r 整理資料}
# install.packages("readxl")
# library(readxl)
library(tidyverse)
library(magrittr)

Nationaldata <- read_excel("./Nationaldata.xlsx")
Nationaldata %>% select(-c(2)) %>% rename(平均每人GDP折合美元 = X__2) %>% 
  rename(平均每人民間消費折合美元 = X__3) -> Nationaldata

Nationaldata[61:70,] -> Nationaldata

# Nationaldata %>% select(c(平均每人GDP:平均每人民間消費折合美元)) %>% as.numeric() 為什麼這個式子跑不動？

as.numeric(Nationaldata$平均每人GDP) -> Nationaldata$平均每人GDP
as.numeric(Nationaldata$平均每人GDP折合美元) -> Nationaldata$平均每人GDP折合美元
as.numeric(Nationaldata$平均每人民間消費支出) -> Nationaldata$平均每人民間消費支出
as.numeric(Nationaldata$平均每人民間消費折合美元) -> Nationaldata$平均每人民間消費折合美元

Nationaldata %<>% mutate(人均消費支出佔GDP比重=平均每人民間消費支出/平均每人GDP)

```

```{r 整理消費佔GDP近十年比重}
Nationaldata %>% summarise(近十年人均消費支出佔GDP比重=mean(人均消費支出佔GDP比重))
#0.5380801
```

根據勞動部資料，我們假設每週工時為40 + 46*0.2*0.25(一個月有20%時間需要加班) = 42.3hr。因此起初每週工作比例lzero = 42.3/(24*5) = 0.3525。

> 勞動基準法第30條：勞工每日正常工作時間不得超過8小時，每週正常工作時數不得超過40小時。以及，勞動基準法第32條：雇主延長勞工之工作時間連同正常工作時間，1日不得超過12小時。 延長之工作時間，1個月不得超過46小時。

進一步地帶入l*公式，可求得資本的起初值kzero
```{r 求解起初l*}
lzero <- 0.3525

funtok <- function(k) {
  lzero           #每週工作時數估計0.2518(42.3hr)
  rho2 <- 0.01115 #台灣銀行定存利率
  delta2 <- 0.04 #折舊率(解釋：)
  tau_k2 <- 0.3  #(房屋稅+(工地原地)房屋稅）/2（解釋：）
  alpha2 <- 0.467 #利用y=A*L^alpha*K^(1-alpha)，取ln後由GDP成長率來算
  sigma2 <- 0.7  #毛慶生論文
  A2 <- 1 #normalized to 1
  epislon2 <- 0.77 #毛慶生論文
  tau_l2 <- 0.12 #財政部
  tau_c2 <- 0.05 #發票
  
  #l已知，求解k
  return(lzero-(((rho2+delta2*(1-tau_k2))/((1-tau_k2)*(1-alpha2)*A2))^(1/alpha2))*k)

}

uniroot(funtok, c(-3,50), tol = 0.000000001) -> solofk

solofk

solofk$root -> kzero

```

```{r 期初l and k}
lzero #0.3525
kzero #44.02699
```

進一步地，我們可以求得起初的消費c是多少。czero = 1.990871
```{r 求解期初c}
funtoc <- function(c) {
  rho2 <- 0.01115 #台灣銀行定存利率
  delta2 <- 0.04 #折舊率(解釋：)
  tau_k2 <- 0.3  #(房屋稅+(工地原地)房屋稅）/2（解釋：）
  alpha2 <- 0.467 #利用y=A*L^alpha*K^(1-alpha)，取ln後由GDP成長率來算
  sigma2 <- 0.7  #毛慶生論文
  A2 <- 1 #normalized to 1
  epislon2 <- 0.77 #毛慶生論文
  tau_l2 <- 0.12 #財政部
  tau_c2 <- 0.05 #發票
  
  #kzero已知，求解c
  return(c-(((rho2+delta2*(1-tau_k2))/((1-tau_k2)*(1-alpha2)))-delta2)*kzero)
}

uniroot(funtoc, c(-3,50), tol = 0.000000001) -> solofc

solofc$root -> czero

czero

```

```{r 期初c l k}
lzero #0.3525
kzero #44.02699
czero #2.858746
```

```{r set to global enviro}
lzero 
kzero 
czero 
rho2 <- 0.01115 #台灣銀行定存利率
delta2 <- 0.04 #折舊率(解釋：)
tau_k2 <- 0.3  #(房屋稅+(工地原地)房屋稅）/2（解釋：）
alpha2 <- 0.467 #利用y=A*L^alpha*K^(1-alpha)，取ln後由GDP成長率來算
sigma2 <- 0.7  #毛慶生論文
A2 <- 1 #normalized to 1
epislon2 <- 0.77 #毛慶生論文
tau_l2 <- 0.12 #財政部
tau_c2 <- 0.05
```

```{r 期初y值}
yzero <- A2*(lzero^alpha2)*(kzero^(1-alpha2))
yzero
```

```{r 期初內解變數值}
lzero #0.3525
kzero #44.02699
czero #2.858746
yzero #4.619825
```

```{r 求解chi}
funTochi <- function(chi){
    rho2 <- 0.01115 #台灣銀行定存利率
    delta2 <- 0.04 #折舊率(解釋：)
    tau_k2 <- 0.3  #(房屋稅+(工地原地)房屋稅）/2（解釋：）
    alpha2 <- 0.467 #利用y=A*L^alpha*K^(1-alpha)，取ln後由GDP成長率來算
    sigma2 <- 0.7  #毛慶生論文
    A2 <- 1 #normalized to 1
    epislon2 <- 0.77 #毛慶生論文
    tau_l2 <- 0.12 #財政部
    tau_c2 <- 0.05
    
    w <- A2*alpha2*(lzero^(alpha2-1))*(kzero^(1-alpha2))
    
M <- ((1-tau_l2)*w)/(chi*(1+tau_c2))

P <- (1-(((rho2+delta2*(1-tau_k2))/((1-tau_k2)*(1-alpha2)*A2))^(1/alpha2))*kzero)
Q <- (((1-tau_k2)*(1-alpha2))/(rho2+alpha2*delta2*(1-tau_k2)))

return(kzero-(((M^(1/sigma2))*(P^(epislon2/sigma2))*Q)))
}

uniroot(funTochi, c(0,10000), tol = 0.0001, extendInt = "yes") -> solofchi2


chi2 <- solofchi2$root
chi2
```

```{r 計算期初u值}
R <- ((czero^(1-sigma2)-1)/(1-sigma2))
S <- chi2*(((1-lzero)^(1-epislon2))/(1-epislon2))
uzero <- R+S
```


```{r 期初內解變數值&chi}
lzero #0.3525
kzero #44.02699
czero #2.858746
yzero #4.619825
chi2 #1.759573
uzero #8.15725 因為sigma我們用的是0.77，題目模型是2，差稍微多一些
Beforestatics <- c(kzero, lzero, czero, yzero, uzero,chi2)
Beforestatics
```

> 我要怎麼驗證我做出來的c和實際有的National data是符合的，好像有點不太明白我們模擬出來的c，他的單位是什麼？那是否至少y要大於c，論文：0.3107 0.4638。k是存量，所以可以很大。

### 做比較靜態
```{r 比較靜態外生參數 tau_k3=0.25}

rho3 <- 0.01115 #台灣銀行定存利率
delta3 <- 0.04 #折舊率(解釋：)
#降税
tau_k3 <- 0.25  #(房屋稅+(工地原地)房屋稅）/2（解釋：） 
alpha3 <- 0.467 #利用y=A*L^alpha*K^(1-alpha)，取ln後由GDP成長率來算
sigma3 <- 0.7  #毛慶生論文
A3 <- 1 #normalized to 1
epislon3 <- 0.77 #毛慶生論文
tau_l3 <- 0.12 #財政部
tau_c3 <- 0.05
chi3 <- chi2
```

```{r 求解新的k, kone}
funToFindkone <- function(kone){
    rho3 
    delta3 
    tau_k3
    alpha3 <- 0.467 
    sigma3 <- 0.7  
    A3 <- 1 
    epislon3 <- 0.77 
    tau_l3 <- 0.12 
    tau_c3 <- 0.05
    chi3
    l <- (((rho3+delta3*(1-tau_k3))/((1-tau_k3)*(1-alpha3)*A3))^(1/alpha3))*kone
    w <- A3*alpha3*l^(alpha3-1)*kone^(1-alpha3)
    
M <- ((1-tau_l3)*w)/(chi3*(1+tau_c3))

P <- (1-(((rho3+delta3*(1-tau_k3))/((1-tau_k3)*(1-alpha3)*A3))^(1/alpha3))*kone)
Q <- (((1-tau_k3)*(1-alpha3))/(rho3+alpha3*delta3*(1-tau_k3)))

return(kone-(((M^(1/sigma3))*(P^(epislon3/sigma3))*Q)))
}

uniroot(funToFindkone, c(1,50), tol = 0.000000001) -> solofkone

kone1 <- solofkone$root
kone1
```

```{r 求解比較靜態後的其他內解變數值}
funoflcone <- function(kvalue) {
  rho3 
  delta3 
  tau_k3
  alpha3 <- 0.467 
  sigma3 <- 0.7  
  A3 <- 1 
  epislon3 <- 0.77 
  tau_l3 <- 0.12 
  tau_c3 <- 0.05
  chi3
  lone <- (((rho3+delta3*(1-tau_k3))/((1-tau_k3)*(1-alpha3)*A3))^(1/alpha3))*kvalue
  cone <- (((rho3+delta3*(1-tau_k3))/((1-tau_k3)*(1-alpha3)))-delta3)*kvalue
  yone <- A3*(lone^alpha3)*(kvalue^(1-alpha3))
  
  R <- ((cone^(1-sigma3)-1)/(1-sigma3))
  S <- chi3*(((1-lone)^(1-epislon3))/(1-epislon3))
  uone <- R+S
  
  c(kvalue,lone,cone,yone,uone,chi3) -> Afterstatics
  Afterstatics
}

funoflcone(kone1)
Beforestatics

#lone = 0.256691 > lzero = 0.2518 why?


```


### 設定參數

內生變數：

- y : 這邊要用人均的，因為A也是有normalized到1

- c

- l : 勞動基準法第30條：勞工每日正常工作時間不得超過8小時，每週正常工作時數不得超過40小時。 勞動基準法第32條：雇主延長勞工之工作時間連同正常工作時間，1日不得超過12小時。 延長之工作時間，1個月不得超過46小時。

每週工時假設為：40+46*0.2=49.2，約取50hr。50/168=0.2976

- k

#### 設定外生參數

- 時間偏好率(rho)：參考自臺灣銀行定期存款利率。時間偏好率為個人主觀在跨期選擇時候，對當期消費的偏愛程度。市場利率則為現實世界借貸雙方的達成均衡的市場利率，加上臺灣進入低利時代已久，因此民眾普遍以定存利率當做當期與未來做消費投資的基本參考。因此其作為時間偏好率。

- 折舊率(delta)：

- 資本利得稅（tau_k）：

- 產生勞動份額（labor share)(alpha) ：將生產函數取ln微分


